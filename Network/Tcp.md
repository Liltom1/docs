### `Tcp`

#### 1.三次握手和四次挥手

##### 三次握手

相关名词

- `seq`（sequence number），序列号随机生成的

- `ack`（acknowledgement number）确认号 `ack` = `seq`+ 1

- `ACK` （acknowledgement）确定序列号有效

- `SYN`（synchronous）发起新连接

- `FIN` （FINISH）完成

客户端与服务端

###### 1，准备链接 

TCP服务端创建传输控制模块`TCB`，进入LISTEN（监听）状态 ，TCP客户端也同样先创建传输控制模块`TCB` 。

###### 2，TCP客户端发起第一次握手

TCP客户端向服务器发出连接请求报文，报文参数如下

-  报文中的首部位SYN = 1 ，预示着发起新链接

-  同时会附带一个seq=x(*一个随机的序列号 这里用x代替*) 

发送后`TCB`进入SYN-SENT（同步已发送状态），TCP规定，SYN报文段（SYN=1的报文段）不能携带数据，但需要消耗掉一个序号。

###### 3，TCP服务器接受请求，然后发起第二次握手

TCP服务器接受到请求后，同意链接，就会返回发出确认报文，报文中携带的参数有，

-  `ACK` = 1(你的请求序列号是有效的)
-  `SYN` = 1 发起新链接
-  `seq` = y （自己初始化一个随机的序列号）
-  `ack` = x+1  (小写的`ack`为确认号，x为第一次客户端握手中的seq 随机序列号 )

此时，TCP服务器进程进入了`SYN-RCVD`（同步收到）状态。这个报文也不能携带数据，但是同样要消耗一个序号。

###### 4，TCP客户端接受到服务器返回，然后发起第三次握手

TCP客户进程收到确认后，还要向服务器给出确认，确认报文参数如下

- `ACK` = 1(你的请求序列号是有效的)
- `seq` = x+1(x为第一次客户端握手中的seq 随机序列号 )
- ` ack` = y+1 (y为第二次握手中服务器端的seq 随机序列号 )

此时，TCP连接建立，客户端进入ESTABLISHED（已建立连接）状态。TCP规定，`ACK`报文段可以携带数据，但是如果不携带数据则不消耗序号。

###### 5，当服务器收到客户端的确认后也进入ESTABLISHED状态，此后双方就可以开始通信了。